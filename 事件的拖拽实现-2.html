<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>js实现拖拽效果</title>
		<style>
			div{
				width: 100px;
				height: auto;
				background:pink;
				border-width: thick;
				text-align: center;
				position: absolute;
				left: 0;
				top: 0;
			}
		</style>
	</head>
	<body>
		<div>
			 点击鼠标，进行拖拽
		</div>
		<script type="text/javascript">
			//---------封装一个添加事件的兼容方法
			//-----elem: 目标元素 div/button....
			//-----evtType: 事件类型 onmousedown/click....
			//-----handleFun: 事件函数
			function addEvent(elem, evtType, handleFun){
				if(elem.addEventListener){
					elem.addEventListener(evtType, handleFun, false);
				}else if(elem.attachment){
					elem.attachment('on'+evtType, function(){
						handleFun.call(elem); //改变attachment函数原来的this执行为当前元素
					});
				}else{
					elem['on'+evtType] = handleFun;
				}
			}
			
			//---------封装一个兼容性的获取全局样式的方法
			//--------elem: 目标元素 , prop: 要获取样式中的css属性名
			function getStyle(elem, prop){
				if(window.getComputedStyle){
					return window.getComputedStyle(elem,null)[prop];
				}else{
					return elem.currentstyle[prop];
				}
			}
			
			//封装一个解除事件绑定的兼容函数
			function removeEvent(ele, type, fun){
				if(ele.addEventListener){
					ele.removeEventListener(type, fun, false);
				}else{
					ele['on'+type] = null;
				}
			}
			
			//封装一个取消冒泡的兼容函数
			function stopBubble(evt){
				if(evt.stopPropagation){
					evt.stopPropagation();
				}else{
					evt.cancelBubble = true;
				}
			}
			
			//封装一个取消默认事件的函数
			function cancelPrevent(evt){
				if(evt.preventDefault){
					evt.preventDefault();
				}else{
					evt.returnValue = false;
				}
			}
			
			
			//拖拽方法封装
			//-----------elem: 要被拖拽的目标元素
			function drag(elem){
				console.log('-------------');
				var disX, disY;
				addEvent(elem, 'mousedown', function(e){
					var evt = e || window.event;
					disX = evt.clientX - parseInt(getStyle(elem,'left'));
					disY = evt.clientY - parseInt(getStyle(elem,'top'));
					addEvent(document, 'mousemove', mouseMove);
					addEvent(document, 'mouseup', mouseUp);
					stopBubble(evt);
					cancelPrevent(evt);
				});
				//-----------改变目标元素的位置方法: 让目标元素跟随鼠标移动方向进行左右和上下移动
				function mouseMove(e){
					var evt = e || window.event;
					elem.style.left = evt.pageX - disX + 'px';
					elem.style.top = evt.pageY - disY + 'px';
				}
				//-------------鼠标放开时触发事件关闭方法
				function mouseUp(e){
					//e = e || window.event;
					removeEvent(document,'mousemove',mouseMove);
					removeEvent(document,'mouseup',mouseUp)
				}
			}
			//调用拖拽函数
			drag(document.getElementsByTagName('div')[0]);
		</script>
	</body>
</html>
